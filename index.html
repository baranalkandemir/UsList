<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shared Bucket List</title>
<style>
  body { font-family: Arial, sans-serif; background: #fef6f0; display: flex; justify-content: center; align-items: center; height: 100vh; }
  .container { background: #fff; padding: 20px 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 350px; }
  h1 { text-align: center; color: #ff6b6b; margin-bottom: 20px; }
  
  /* İlerleme Çubuğu Stilleri */
  .progress-container {
    margin-bottom: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
  }
  
  .progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: 14px;
    font-weight: 600;
  }
  
  #progressText {
    color: #495057;
  }
  
  #progressPercentage {
    color: #ff6b6b;
    font-size: 16px;
  }
  
  .progress-bar {
    width: 100%;
    height: 12px;
    background: #e9ecef;
    border-radius: 6px;
    overflow: hidden;
    position: relative;
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #ff6b6b, #ff8e8e, #ffa8a8);
    border-radius: 6px;
    width: 0%;
    transition: width 0.5s ease-in-out;
    position: relative;
  }
  
  .progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: shimmer 2s infinite;
  }
  
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
  input { width: 70%; padding: 8px; margin-right: 5px; border-radius: 5px; border: 1px solid #ccc; }
  button { padding: 8px 12px; border: none; border-radius: 5px; background-color: #ff6b6b; color: #fff; cursor: pointer; }
  ul { list-style: none; padding: 0; margin-top: 20px; position: relative; }
  li { padding: 8px; margin-bottom: 8px; background: #fceae9; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; overflow: visible; transform-origin: center; position: relative; }
  .completed { text-decoration: line-through; opacity: 0.6; transform: translateX(2px); }
  li button { background: #ff8787; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; margin-left: 6px; }

  /* Tamamlama vurgu animasyonu */
  li.completing { animation: completePop 280ms ease forwards; }
  @keyframes completePop {
    0% { transform: scale(1); background-color: #fceae9; }
    50% { transform: scale(1.03); background-color: #e6fff0; }
    100% { transform: scale(1); background-color: #fceae9; }
  }

  /* Yeni: döndürüp uçuran silme animasyonu (swirl-away) */
  li.fade-out {
    animation: swirlAway 520ms cubic-bezier(.2,.9,.2,1) forwards;
    transform-origin: center;
    will-change: transform, opacity, filter, height;
    z-index: 5;
  }

  @keyframes swirlAway {
    0% {
      opacity: 1;
      transform: rotate(0deg) translateX(0) translateY(0) scale(1);
      filter: none;
      height: auto; margin-bottom: 8px; padding-top: 8px; padding-bottom: 8px;
    }
    25% {
      transform: rotate(8deg) translateX(8px) translateY(-6px) scale(0.98) skew(-3deg,-2deg);
      filter: blur(0.2px) brightness(0.98);
    }
    55% {
      transform: rotate(-22deg) translateX(48px) translateY(-28px) scale(0.72) skew(6deg,4deg);
      opacity: 0.7;
      filter: blur(0.9px) grayscale(0.08);
    }
    85% {
      transform: rotate(32deg) translateX(120px) translateY(-50px) scale(0.38) skew(10deg,6deg);
      opacity: 0.2;
      filter: blur(1.6px) grayscale(0.35);
    }
    100% {
      transform: rotate(48deg) translateX(220px) translateY(-90px) scale(0.18) skew(14deg,9deg);
      opacity: 0;
      filter: blur(2.4px) grayscale(0.6);
      height: 0; margin-bottom: 0; padding-top: 0; padding-bottom: 0;
    }
  }

  /* Ekleme (pop-in) animasyonu */
  li.adding { animation: popIn 260ms cubic-bezier(.2,.8,.2,1) both; }
  @keyframes popIn {
    0% { transform: scale(0.96) translateY(6px); opacity: 0; }
    60% { transform: scale(1.06) translateY(-2px); opacity: 1; }
    100% { transform: scale(1) translateY(0); opacity: 1; }
  }
  /* clone used for robust delete animation (absolute positioned inside #bucketList) */
  .item-clone {
    position: absolute;
    left: 0; top: 0;
    margin: 0;
    pointer-events: none;
    z-index: 1000;
    box-sizing: border-box;
    transform-origin: center;
  }
  /* heart pop for newly added items */
  /* simpler emoji-based heart to avoid clip-path issues */
  .heart {
    position: fixed;
    pointer-events: none;
    transform-origin: center;
    font-size: 24px;
    line-height: 1;
    color: #ff3b61;
    text-shadow: 0 2px 8px rgba(255,59,97,0.4);
    opacity: 0; /* start hidden; animation will show it */
    display: inline-block;
    z-index: 1000;
  }
  .heart.pop {
    animation: heartPop 800ms ease-out forwards;
  }
  @keyframes heartPop {
    0% { 
      transform: translateX(-50%) scale(0.5) translateY(0px); 
      opacity: 0; 
    }
    50% { 
      transform: translateX(-50%) scale(1.2) translateY(-20px); 
      opacity: 1; 
    }
    100% { 
      transform: translateX(-50%) scale(0.8) translateY(-40px); 
      opacity: 0; 
    }
  }
  
  /* Confetti effect for completed items */
  .confetti {
    position: fixed;
    pointer-events: none;
    z-index: 9999;
    font-size: 20px;
    animation: confettiFall 4s ease-out forwards;
  }
  
  @keyframes confettiFall {
    0% {
      transform: translateY(-100vh) rotate(0deg) scale(0.5);
      opacity: 1;
    }
    20% {
      transform: translateY(-50vh) rotate(180deg) scale(1.2);
      opacity: 1;
    }
    50% {
      transform: translateY(20vh) rotate(360deg) scale(1);
      opacity: 0.8;
    }
    100% {
      transform: translateY(100vh) rotate(720deg) scale(0.3);
      opacity: 0;
    }
  }
</style>
</head>
<body>
<div class="container">
  <h1>Bucket List</h1>
  
  <!-- İlerleme Çubuğu -->
  <div class="progress-container">
    <div class="progress-info">
      <span id="progressText">0 / 0 tamamlandı</span>
      <span id="progressPercentage">0%</span>
    </div>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>
  
  <input type="text" id="itemInput" placeholder="Yeni madde ekle...">
  <button id="addBtn">Ekle</button>
  <ul id="bucketList"></ul>
</div>

<!-- Firebase Compat SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // JavaScript başlatıldı
  console.log('=== JAVASCRIPT ÇALIŞIYOR ===');
  
  // 🔹 Firebase config → kendi proje bilgilerini buraya yapıştır
  const firebaseConfig = {
    apiKey: "AIzaSyAno-PGGU1YTHEgQXvm4jnW2JpqWOezFac",
    authDomain: "uslist-8ac7a.firebaseapp.com",
    databaseURL: "https://uslist-8ac7a-default-rtdb.firebaseio.com",
    projectId: "uslist-8ac7a",
    storageBucket: "uslist-8ac7a.appspot.com",
    messagingSenderId: "404246675807",
    appId: "1:404246675807:web:fdb214fed0ff817bdeb6ea",
    measurementId: "G-8HZGPTTE31"
  };

  // Firebase başlat (güvenli versiyon)
  console.log('Firebase başlatılıyor...');
  let items = {}; // Local storage için
  let lastAddedKey = null;
  let db = null;
  let listRef = null;
  
  try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.database();
    listRef = db.ref('bucketList');
    console.log('Firebase başarıyla başlatıldı!');
    
    // Firebase'den veriyi dinle
    listRef.on('value', snapshot => {
      const data = snapshot.val() || {};
      items = data;
      renderList(items);
    });
  } catch (error) {
    console.error('Firebase hatası, offline modda çalışıyor:', error);
    // Offline modda çalış
    loadItems();
  }

  const input = document.getElementById('itemInput');
  const addBtn = document.getElementById('addBtn');
  const list = document.getElementById('bucketList');
  
  // İlerleme çubuğu elementleri
  const progressText = document.getElementById('progressText');
  const progressPercentage = document.getElementById('progressPercentage');
  const progressFill = document.getElementById('progressFill');

  // Son eklenen öğenin anahtarı (ekle animasyonu için) - zaten yukarıda tanımlandı

  // İlerleme çubuğunu güncelle
  function updateProgressBar(items) {
    const totalItems = Object.keys(items).length;
    const completedItems = Object.values(items).filter(item => item.completed).length;
    const percentage = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;
    
    // Metinleri güncelle
    progressText.textContent = `${completedItems} / ${totalItems} tamamlandı`;
    progressPercentage.textContent = `${percentage}%`;
    
    // Çubuğu güncelle
    progressFill.style.width = `${percentage}%`;
    
    // Renk değişimi (0-33% kırmızı, 34-66% turuncu, 67-100% yeşil)
    if (percentage === 0) {
      progressFill.style.background = 'linear-gradient(90deg, #e9ecef, #e9ecef)';
    } else if (percentage <= 33) {
      progressFill.style.background = 'linear-gradient(90deg, #ff6b6b, #ff8e8e, #ffa8a8)';
    } else if (percentage <= 66) {
      progressFill.style.background = 'linear-gradient(90deg, #ffa726, #ffb74d, #ffcc80)';
    } else {
      progressFill.style.background = 'linear-gradient(90deg, #66bb6a, #81c784, #a5d6a7)';
    }
  }

  // Listeyi ekrana yazdır (event listener'lar ile)
  function renderList(items) {
    list.innerHTML = '';
    for (let key in items) {
      const item = items[key];
      const li = document.createElement('li');
      li.dataset.key = key;
      if (item.completed) li.classList.add('completed');

      // Eğer bu anahtar son eklenen ise ekle animasyonu uygula
      if (key === lastAddedKey) {
        li.classList.add('adding');
        const onAnimEndAdd = () => {
          li.classList.remove('adding');
          li.removeEventListener('animationend', onAnimEndAdd);
          lastAddedKey = null;
        };
        li.addEventListener('animationend', onAnimEndAdd);

        // Heart animasyonu
        showHeartAnimation();
      }

      const span = document.createElement('span');
      span.textContent = item.text;

      const controls = document.createElement('div');

      const completeBtn = document.createElement('button');
      completeBtn.textContent = '✓';
      completeBtn.title = item.completed ? 'Tamamlamayı kaldır' : 'Tamamla';
      completeBtn.addEventListener('click', () => animateToggleComplete(key, !item.completed));

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = '🗑️';
      deleteBtn.title = 'Sil';
      deleteBtn.addEventListener('click', () => animateDelete(key, li));

      controls.appendChild(completeBtn);
      controls.appendChild(deleteBtn);

      li.appendChild(span);
      li.appendChild(controls);
      list.appendChild(li);
    }
    
    // İlerleme çubuğunu güncelle
    updateProgressBar(items);
  }

  // Local storage'dan veriyi yükle (offline mod için)
  function loadItems() {
    const saved = localStorage.getItem('bucketList');
    if (saved) {
      items = JSON.parse(saved);
    }
    renderList(items);
  }

  // Heart animasyonu fonksiyonu
  function showHeartAnimation() {
    // Çok basit bir heart elementi
    const heart = document.createElement('div');
    heart.innerHTML = '❤️';
    heart.style.cssText = `
      position: fixed;
      font-size: 30px;
      color: red;
      z-index: 9999;
      pointer-events: none;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      animation: heartBounce 1s ease-out forwards;
    `;
    
    // CSS animasyonu inline olarak ekle
    const style = document.createElement('style');
    style.textContent = `
      @keyframes heartBounce {
        0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
        50% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; }
        100% { transform: translate(-50%, -50%) scale(1) translateY(-100px); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(heart);
    
    // 2 saniye sonra kaldır
    setTimeout(() => {
      if (heart.parentNode) {
        heart.parentNode.removeChild(heart);
      }
      if (style.parentNode) {
        style.parentNode.removeChild(style);
      }
    }, 2000);
  }

  // Confetti animasyonu fonksiyonu
  function showConfettiAnimation() {
    const confettiEmojis = ['🎉', '🎊', '✨', '🌟', '💫', '⭐', '🎈', '🎁', '🎂', '🍰', '🎀', '🎆', '🎇', '🌈', '💎', '🔥'];
    const confettiCount = 50; // 20'den 50'ye çıkarıldı
    
    for (let i = 0; i < confettiCount; i++) {
      setTimeout(() => {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.innerHTML = confettiEmojis[Math.floor(Math.random() * confettiEmojis.length)];
        
        // Rastgele pozisyon ve renk
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.color = `hsl(${Math.random() * 360}, 70%, 60%)`;
        confetti.style.fontSize = (Math.random() * 15 + 20) + 'px'; // Daha büyük boyutlar
        confetti.style.textShadow = `0 0 10px rgba(255,255,255,0.8)`; // Parlak efekt
        
        document.body.appendChild(confetti);
        
        // 4 saniye sonra kaldır (daha uzun süre)
        setTimeout(() => {
          if (confetti.parentNode) {
            confetti.parentNode.removeChild(confetti);
          }
        }, 4000);
      }, i * 30); // Her confetti 30ms arayla düşer (daha hızlı)
    }
  }

  function addItem() {
    const text = input.value.trim();
    if(text) {
      if (listRef) {
        // Firebase kullan - lastAddedKey'i hemen ayarla
        const newItemRef = listRef.push();
        lastAddedKey = newItemRef.key; // Hemen ayarla
        newItemRef.set({ text, completed: false });
      } else {
        // Offline mod
        const key = Date.now().toString();
        items[key] = { text, completed: false };
        localStorage.setItem('bucketList', JSON.stringify(items));
        lastAddedKey = key;
        renderList(items);
      }
      
      input.value = '';
    }
  }

  // Tamamlama animasyonlı güncelleme
  function animateToggleComplete(key, status) {
    const li = list.querySelector(`[data-key="${key}"]`);
    if (!li) {
      // fallback: doğrudan güncelle
      if (listRef) {
        listRef.child(key).update({ completed: status });
      } else {
        items[key].completed = status;
        localStorage.setItem('bucketList', JSON.stringify(items));
      }
      return;
    }

    // görsel animasyon
    li.classList.add('completing');
    // hemen görsel tamamlandı sınıfı ayarla (kullanıcı anlık geri bildirim görsün)
    if (status) li.classList.add('completed'); else li.classList.remove('completed');

    // Eğer tamamlanıyorsa confetti animasyonu göster
    if (status) {
      showConfettiAnimation();
    }

    // animasyon bitişinde sınıfı temizle
    const onAnimEnd = () => {
      li.classList.remove('completing');
      li.removeEventListener('animationend', onAnimEnd);
    };
    li.addEventListener('animationend', onAnimEnd);

    // veriyi animasyon sonrası güncelle (küçük gecikme)
    setTimeout(() => {
      if (listRef) {
        listRef.child(key).update({ completed: status });
      } else {
        items[key].completed = status;
        localStorage.setItem('bucketList', JSON.stringify(items));
      }
    }, 280);
  }

  // Silme animasyonlu silme: klon oluşturup klonu animasyonla oynat, orijinali gizle,
  // animasyon bittiğinde veritabanından sil ve klonu kaldır.
  function animateDelete(key, liElement) {
    const el = liElement || list.querySelector(`[data-key="${key}"]`);
    if (!el) {
      // fallback: doğrudan sil
      if (listRef) {
        listRef.child(key).remove();
      } else {
        delete items[key];
        localStorage.setItem('bucketList', JSON.stringify(items));
      }
      return;
    }

    // eğer zaten siliniyorsa tekrar tetikleme
    if (el.dataset.deleting === '1') return;
    el.dataset.deleting = '1';

    // Hesapla: orijinalin boyut ve pozisyonu göre klonu absolute yerleştir
    const rect = el.getBoundingClientRect();
    const listRect = list.getBoundingClientRect();

    // Klon oluştur
    const clone = el.cloneNode(true);
    clone.classList.remove('adding','completing');
    clone.classList.add('item-clone','fade-out');

    // Inline stil ile absolute konumlandır
    clone.style.width = rect.width + 'px';
    clone.style.height = rect.height + 'px';
    // position relative #bucketList üzerine yerleştirmek için offset hesapla
    clone.style.left = (rect.left - listRect.left) + 'px';
    clone.style.top = (rect.top - listRect.top) + 'px';

    // Orijinali görünmez yap (layout bozulmasın diye visibility kullan)
    el.style.visibility = 'hidden';

    // #bucketList'e klonu ekle
    list.appendChild(clone);

    // animasyon bittikten sonra veritabanından sil ve klonu kaldır
    const onAnimEnd = () => {
      clone.removeEventListener('animationend', onAnimEnd);
      // veritabanından sil
      if (listRef) {
        listRef.child(key).remove();
      } else {
        delete items[key];
        localStorage.setItem('bucketList', JSON.stringify(items));
      }
      // küçük gecikmeyle DOM temizle
      requestAnimationFrame(() => {
        if (clone.parentNode) clone.parentNode.removeChild(clone);
        // orijinal zaten re-render ile kaybolacaktır; ama eğer kalırsa temizle
        if (el.parentNode) el.parentNode.removeChild(el);
      });
    };
    clone.addEventListener('animationend', onAnimEnd);
  }

  addBtn.addEventListener('click', addItem);
  input.addEventListener('keypress', e => { if(e.key === 'Enter') addItem(); });
</script>
</body>
</html>
